<html>
<head>
<title> Word Cloud </title>
</head>
<body>

<style>
#wordCloud{
    height: 100%;
    width: 100%;
}
</style>


<div id="wordCloud"></div>

<script>

// let's discuss about style -> distance between words
var distance = 0.7;

// Input data -> must wonder which weight average to choose /!\
var data = [{word: "bonjour", weight: 33},{word: "visualstudio", weight: 45},
				{word: "javascript", weight: 35},{word: "code", weight: 25},
				{word: "tweets", weight:95},{word: "projet", weight: 55},
				{word: "kim", weight: 58},{word: "ok", weight: 72},
				{word: "rendu", weight: 56},{word: "team", weight: 53},
				{word: "work", weight: 41},{word: "party", weight: 15},
				{word: "todo", weight: 21},{word: "perfect", weight: 20}];

// Sort data
data.sort(function(w1, w2) {
    return -1 * (w1.weight - w2.weight);
});

// Cloud config
var divWordCloud = document.getElementById("wordCloud");

// Canvas config
/*var canvas = document.createElement("canvas");
canvas.width = divWordCloud.width;
canvas.height = divWordCloud.height;

// ctx config
var ctx = canvas.getContext("2d");
divWordCloud.appendChild(canvas);*/

// visited words
var wordsVisited = [];

// function creating words div
function createWordDiv(word, weight) {
	// new div element
    var wordContainer = document.createElement("div");
	// return word when clicked
	wordContainer.addEventListener("click", function() { 
		console.log(this.innerHTML);
	});
	// when mouse over display pop up
	wordContainer.addEventListener("mouseover", function() { 
		this.style.color = "red";
		this.title = weight;
		//TODO add word to searchbar
	});
	// when mouse out set text black
	wordContainer.addEventListener("mouseout", function() { 
		this.style.color = "black";
	});
	
	// position must be ABSOLUTE
    wordContainer.style.position = "absolute";
	// font size
    wordContainer.style.fontSize = weight + "px";
	// famous distance between words ;-)
    wordContainer.style.lineHeight = distance;
	// add child
    wordContainer.appendChild(document.createTextNode(word));
	// return result
    return wordContainer;
}

// function check if place is free
function checkPlaceFree(word, x, y) {
	// add child
    divWordCloud.appendChild(word);    
    // important ! 
    word.style.left = x - word.offsetWidth/2 + "px";
    word.style.top = y - word.offsetHeight/2 + "px";
	// get smallest word in rect
    var current = word.getBoundingClientRect();
    // for each visited words
    for(var i = 0; i < wordsVisited.length; i++){
        // if current word not in intersection with one of the visited words
		// then free place found ! (add some value to move words from each other)
        if(!(current.right < wordsVisited[i].left || current.left > wordsVisited[i].right + 5||
            current.bottom < wordsVisited[i].top || current.top > wordsVisited[i].bottom + 5)){
            // place found return true
			return true;
        }
    }
	// if no place found return false
    return false;
}

// function to turn around visited words with a callback
function spiral(angle, callback) {
    x = (1 + angle) * Math.cos(angle);
    y = (1 + angle) * Math.sin(angle);
    return callback();
}

// function to place words
function placeWords() {
	// importants positions variables
	var divWordCloudWidth = divWordCloud.offsetWidth / 2;
	var divWordCloudHeight  = divWordCloud.offsetHeight / 2;
	// for each (word, weight) in data array
    for (var i = 0; i < data.length; i += 1) {
		// create div and set couple with (word, wright)
        var couple = createWordDiv(data[i].word, data[i].weight);
		// turn around to find a free place -> 1080Â°
        for (var j = 0; j < 1080; j++) {
            //If function spiral returns true, 
			// free place for word available -> return true and break
			if (spiral(j, function() {
                if (!checkPlaceFree(couple, divWordCloudWidth + x, divWordCloudHeight + y)) {
					// add child
					divWordCloud.appendChild(couple);
					// add rect's element in visted words
					wordsVisited.push(couple.getBoundingClientRect());;
                    return true;
                }
            })) {
				// leave loop for
                break;
            }
        }
    }
}

// call to place words -> the main function
placeWords();

</script>
</body>
</html>